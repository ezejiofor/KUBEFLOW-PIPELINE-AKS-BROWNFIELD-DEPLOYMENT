apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# ============================================================================
# KUSTOMIZE SETTINGS
# ============================================================================
sortOptions:
  order: legacy
  legacySortOptions:
    orderFirst:
      - Namespace
      - ResourceQuota
      - StorageClass
      - CustomResourceDefinition
      - MutatingWebhookConfiguration
      - ServiceAccount
      - PodSecurityPolicy
      - NetworkPolicy
      - Role
      - ClusterRole
      - RoleBinding
      - ClusterRoleBinding
      - ConfigMap
      - Secret
      - Endpoints
      - Service
      - LimitRange
      - PriorityClass
      - PersistentVolume
      - PersistentVolumeClaim
      - Deployment
      - StatefulSet
      - CronJob
      - PodDisruptionBudget
    orderLast:
      - ValidatingWebhookConfiguration

# ============================================================================
# KUBEFLOW-SPECIFIC RESOURCES ONLY
# Excludes infrastructure (cert-manager, Istio, Dex, OAuth2-proxy)
# ============================================================================

resources:
  # ==========================================================================
  # NAMESPACES & RBAC
  # ==========================================================================
  - ../../common/kubeflow-namespace/base
  - ../../common/kubeflow-roles/base
  - ../../common/user-namespace/base

  # ==========================================================================
  # KUBEFLOW APPLICATIONS
  # ==========================================================================

  # Kubeflow Pipelines
  - ../../applications/pipeline/upstream/env/platform-agnostic-multi-user

  # Katib (Hyperparameter tuning)
#  - ../../applications/katib/upstream/installs/katib-standalone
  # Katib
  - ../../applications/katib/upstream/installs/katib-with-kubeflow

  # Central Dashboard
  - ../../applications/centraldashboard/upstream/overlays/kserve

  # Notebooks (Notebook Controller + Jupyter Web App)
  - ../../applications/jupyter/notebook-controller/upstream/overlays/kubeflow
#  - ../../applications/jupyter/jupyter-web-app/upstream/overlays/istio           # will replace with aks managed istio config later


  # Profiles & User Management
  - ../../applications/profiles/upstream/overlays/kubeflow

  # Profiles + KFAM with PSS (Pod Security Standards)
  - ../../applications/profiles/pss # TODO MUST BE UPSTREAMED


  # KServe (Model Serving)
  - ../../applications/kserve/kserve
  - ../../applications/kserve/models-web-app/overlays/kubeflow

  # Training Operator (v1)
  # - ../../applications/training-operator/upstream/overlays/kubeflow
  # Trainer (Training Operator v2)
  - ../../applications/trainer/overlays

  # Tensorboards Controller
  - ../../applications/tensorboard/tensorboard-controller/upstream/overlays/kubeflow
  # Tensorboard Web App
#  - ../../applications/tensorboard/tensorboards-web-app/upstream/overlays/istio        # will replace with aks managed istio config later

  # Volumes & PVC Management
  # PVC Viewer
  - ../../applications/pvcviewer-controller/upstream/base
  # Volumes Web App
#  - ../../applications/volumes-web-app/upstream/overlays/istio  # will replace with aks managed istio config later


# Ray is an experimental integration
# Here is the documentation for Ray: https://docs.ray.io/en/latest/
# Here is the internal documentation for Ray: - ../experimental/ray/README.md
# - ../experimental/ray/kuberay-operator/overlays/kubeflow

components:
  # https://kubernetes.io/docs/concepts/security/pod-security-standards/
  # For all static namespaces we already enforce PSS restricted
  # This should be used together with Kubernetes 1.33+ user namespaces to block root user exploits
  - ../../common/security/PSS/dynamic/baseline
